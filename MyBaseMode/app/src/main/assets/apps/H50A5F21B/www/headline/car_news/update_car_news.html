<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/style.css" rel="stylesheet"/>
		<link href="../../css/iconfont.css" rel="stylesheet" />
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<style>
			.add-headline-div{
				margin:5px;background:#FFFFFF;border-radius:5px;
				box-shadow:1px -1px 2px rgba(0,0,0,0.1),-1px 1px 2px rgba(0,0,0,0.1);
			}
			input{
				border:0px;
				font-size: 14px;
			}
			input::-webkit-input-placeholder {
				color: #999999;
			}
			textarea{
				padding: 5px;
				height: 120px;
				font-size: 14px;
			}
			.myself-recruit-xz{
				margin:5px;background: #FE7B07;border-radius:5px;
				text-align: center;height:50px;line-height: 50px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav user-index-top-bg mheader">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left cffffff"></a>
			<h1 class="mui-title cffffff mtitle">修改车辆动态</h1>
		</header>
		<div class="mui-content">
			<div class="add-headline-div">
				<div class="h45 lh45 pl10 pr10 bbf0 oh">
					<div class="fl w30 fs14">
						<span>车辆属性</span>
					</div>
					<div class="fl w60">
						<input type="text"  placeholder="选择车辆属性" readonly="readonly" style="border: 0px;"/>
					</div>
					<div class="fl c24ABFE">
						<span class="iconfont icon-arrLeft-fill fs19"></span>
					</div>
				</div>
			</div>
			<div class="add-headline-div">
				<div class="h45 lh45 pl10 pr10 bbf0 oh">
					<div class="fl w30 fs14">
						<span>开始显示时间</span>
					</div>
					<div class="fl w60">
						<input type="text" placeholder="选择时间" readonly="readonly" style="border: 0px;"/>
					</div>
					<div class="fl c24ABFE">
						<span class="iconfont icon-arrLeft-fill fs19"></span>
					</div>
				</div>
				<div class="h45 lh45 pl10 pr10 bbf0 oh">
					<div class="fl w30 fs14">
						<span>结束显示时间</span>
					</div>
					<div class="fl w60">
						<input type="text" readonly="readonly" placeholder="选择时间"  style="border: 0px;"/>
					</div>
					<div class="fl c24ABFE">
						<span class="iconfont icon-arrLeft-fill fs19"></span>
					</div>
				</div>
				<div class="h45 lh45 pl10 pr10 bbf0 oh">
					<div class="fl w30 fs14">
						<span>车辆大小</span>
					</div>
					<div class="fl w60">
						<input type="number" placeholder="输入座位数"  style="border: 0px;"/>
					</div>
					<div class="fl fs14">
						<span class="">座</span>
					</div>
				</div>
				<div class="h45 lh45 pl10 pr10 bbf0 oh">
					<div class="fl w30 fs14">
						<span>出发时间</span>
					</div>
					<div class="fl w60">
						<input type="text" readonly="readonly" placeholder="选择时间"  style="border: 0px;"/>
					</div>
					<div class="fl c24ABFE">
						<span class="iconfont icon-arrLeft-fill fs19"></span>
					</div>
				</div>
				<div class="h45 lh45 pl10 pr10 bbf0 oh">
					<div class="fl w30 fs14">
						<span>车行区域</span>
					</div>
					<div class="fl w60">
						<input type="text" placeholder="选择车行区域" readonly="readonly"  style="border: 0px;"/>
					</div>
					<div class="fl c24ABFE">
						<span class="iconfont icon-arrLeft-fill fs19"></span>
					</div>
				</div>
				<div class="h45 lh45 pl10 pr10 bbf0 oh">
					<div class="fl w30 fs14">
						<span>出发地</span>
					</div>
					<div class="fl w60">
						<input type="text" placeholder="选择出发地" readonly="readonly"  style="border: 0px;"/>
					</div>
					<div class="fl c24ABFE">
						<span class="iconfont icon-arrLeft-fill fs19"></span>
					</div>
				</div>
				<div class="h45 lh45 pl10 pr10 bbf0 oh">
					<div class="fl w30 fs14">
						<span>目的地</span>
					</div>
					<div class="fl w60">
						<input type="text" placeholder="选择目的地" readonly="readonly"  style="border: 0px;"/>
					</div>
					<div class="fl c24ABFE">
						<span class="iconfont icon-arrLeft-fill fs19"></span>
					</div>
				</div>
				<div class="h45 lh45 pl10 pr10 bbf0 oh">
					<div class="fl w30 fs14">
						<span>联系人</span>
					</div>
					<div class="fl w60">
						<input type="text" placeholder="输入联系人"  style="border: 0px;"/>
					</div>
				</div>
				<div class="h45 lh45 pl10 pr10 bbf0 oh">
					<div class="fl w30 fs14">
						<span>联系电话</span>
					</div>
					<div class="fl w60">
						<input type="number" placeholder="输入联系人电话"  style="border: 0px;"/>
					</div>
				</div>
				<div class=" pl10 pr10  oh">
					<div class="fl w30 fs14 h45 lh45">
						<span>消息内容</span>
					</div>
					<div class="m510">
						<textarea rows="" cols="" placeholder="填写所需发布信息内容"></textarea>
					</div>
				</div>
			</div>
			<div class="myself-recruit-xz" id="add">
				<span class="cffffff fs16">保 存</span>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/castapp.js"></script>
		<script src="../../js/mui.picker.min.js"></script>
		<script type="text/javascript">
			mui.plusReady(function(){
				mui.init({
					swipeBack:true
				})
				ca.init();
				ca.hiddenScroll();
				var citys=[];
				var picker1=new mui.PopPicker();
				var picker2=new mui.PopPicker();
				var inputs=ca.tagName('input');
				var lh45=ca.className('lh45');
				var self=plus.webview.currentWebview();
				find();
				//车辆属性
				function find(){
					ca.ajaxs({url:'findPostmsgCarNewsByid',data:{
							id:self.car_news_id,user_id:localStorage.getItem('userid')
						},succFn:function(data){
							if(data){
								if(data.attr=='顺风车'){
									lh45[5].classList.add('disn');
									inputs[4].value=data.go_time.slice(0,16);
									inputs[6].value=data.city+(data.county?'/'+data.county:'');
									inputs[7].value=data.to_city+(data.to_county?'/'+data.to_county:'');
								}else{
									lh45[4].classList.add('disn');
									lh45[6].classList.add('disn');
									lh45[7].classList.add('disn');
									inputs[5].value=data.city+(data.county?'/'+data.county:'');
								}
								inputs[0].value=data.attr;
								inputs[1].value=data.view_start.slice(0,16);
								inputs[2].value=data.view_end.slice(0,16);
								inputs[3].value=data.seating;
								inputs[8].value=data.contact_name;
								inputs[9].value=data.contact_tel;
								ca.tagName('textarea')[0].value=data.content;
							}
							ca.closeWaiting();
						},errFn:function(err){
							ca.closeWaiting();
							mui.toast(err);
						}
					})
				}
				
				//开始显示时间
				inputs[1].addEventListener('tap',function(){
					showdatapicker(inputs[1])
				})
				//结束显示时间
				inputs[2].addEventListener('tap',function(){
					showdatapicker(inputs[2])
				})
				//出发时间
				inputs[4].addEventListener('tap',function(){
					showdatapicker(inputs[4])
				})
				
				
				
				function showdatapicker(ob){
					var date = new Date();
					var year = date.getFullYear();//年
					var month = date.getMonth() + 1;//月
					var day = date.getDate();//日
					var h = date.getHours();// 小时
					var m = date.getMinutes(); // 分钟
					ca.dateSelect({
						defaultTime:year + '-' + month + '-' + day,
						minTime:year + '-' + month + '-' + day,
						maxTime:year + '-'+ (month + 1) + '-' + day,
						callback:function(data){
							if(data){
								ca.timeSelect({
									defaultTime:h + ':' + m ,
									callback:function(datas){
										if(datas){
											ob.value=data+' '+datas;
										}
									}
								})
							}
							
						}
					})
				}
				//车行区域选择
				inputs[5].addEventListener('tap',function(){
					if(ca.emptyFun(citys)){
						findUserRegion(inputs[5]);
					}else{
						ca.combinationSelect(2,citys,function(da){
							inputs[5].value=da[0].te;
						})
					}
				})
				//出发地选择
				inputs[6].addEventListener('tap',function(){
					if(ca.emptyFun(citys)){
						findUserRegion(inputs[6]);
					}else{
						ca.combinationSelect(2,citys,function(da){
							inputs[6].value=da[0].te;
						})
					}
				})
				//目的地选择
				inputs[7].addEventListener('tap',function(){
					if(ca.emptyFun(citys)){
						findUserRegion(inputs[7]);
					}else{
						ca.combinationSelect(2,citys,function(da){
							inputs[7].value=da[0].te;
						})
					}
				})
				
				//查询工作区域
				function findUserRegion(ob){
					ca.showWaiting();
					ca.ajaxs({url:'findUserRegion',data:{
							user_id:localStorage.getItem('userid')
						},succFn:function(data){
							if(data){
								citys=data;
								ca.combinationSelect(2,data,function(da){
									ob.value=da[0].te;
								})
							}
							ca.closeWaiting();
						},errFn:function(err){
							ca.closeWaiting();
							mui.toast(err);
						}
					})
				}
				ca.id('add').addEventListener('tap',function(){
					if(!inputs[1].value){
						mui.toast('请选择显示时间');
					}else if(!inputs[2].value){
						mui.toast('请选择结束时间');
					}else if(!inputs[3].value){
						mui.toast('请输入车辆大小');
					}else if(!inputs[8].value){
						mui.toast('请输入联系人');
					}else if(!inputs[9].value){
						mui.toast('请输入联系电话');
					}else if(!ca.tagName('textarea')[0].value){
						mui.toast('请输入消息内容');
					}else{
						var datas='';
						if(inputs[0].value=='顺风车'){
							if(!inputs[4].value){
								mui.toast('请选择出发时间');
								return;
							}if(!inputs[6].value){
								mui.toast('请选择出发地');
								return;
							}if(!inputs[7].value){
								mui.toast('请选择目的地');
								return;
							}
							var cirys1=inputs[6].value.split('/');
							var cirys2=inputs[7].value.split('/');
							var to_county='',county='';
							if(cirys1[1]){
								county=cirys1[1];
							}
							if(cirys2[1]){
								to_county=cirys2[1];
							}
							datas={
								user_id:localStorage.getItem('userid'),city:cirys1[0],county:county,
								attr:'顺风车',seating:inputs[3].value,go_time:inputs[4].value,
								to_city:cirys2[0],to_county:to_county,content:ca.tagName('textarea')[0].value,
								contact_name:inputs[8].value,contact_tel:inputs[9].value,
								view_start:inputs[1].value,view_end:inputs[2].value,id:self.car_news_id
							}
						}else{
							if(!inputs[5].value){
								mui.toast('请选择车行区域');
								return;
							}
							var cirys1=inputs[5].value.split('/');
							var county='';
							if(cirys1[1]){
								county=cirys1[1];
							}
							datas={
								user_id:localStorage.getItem('userid'),city:cirys1[0],county:county,
								attr:'团队用车',seating:inputs[3].value,go_time:'',
								to_city:'',to_county:'',content:ca.tagName('textarea')[0].value,
								contact_name:inputs[8].value,contact_tel:inputs[9].value,
								view_start:inputs[1].value,view_end:inputs[2].value,id:self.car_news_id
							}
						}
						ca.showWaiting();
						ca.ajaxs({url:'updatePostmsgCarNews',data:datas,succFn:function(data){
								if(data.msg==1){
									mui.toast('修改成功');
									var arr1=['edit_car_news'];
									ca.sendNotice(arr1,'update',{});
									setTimeout(function(){
										mui.back();
									},1000);
								}else{
									mui.toast('修改成功');
								}
								ca.closeWaiting()
							},errFn:function(err){
								ca.closeWaiting()
								mui.toast(err);
							}
						})
					}
				})
				
			})
			
		</script>
	</body>

</html>
