<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/style.css" />
		<style>
			.mui-table-view-cell{
				height: 40px;
			}
			.mui-table-view-cell span{
				font-size: 15px;
				color: #333333;
				width: 30%;
			}
			.mui-table-view-cell input::-webkit-input-placeholder{
				
				font-size: 13px;
				color: #C3C3C3;
			}
			.mui-bar-nav{
				-webkit-box-shadow: 0 0px 0px #ccc;
    			box-shadow:0 0px 0px #ccc;
			}
			textarea{
				padding:4px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav user-index-top-bg mheader" >
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #FFFFFF !important;"></a>
		    <h1 class="mui-title" style="font-size: 18px !important;color: #FFFFFF !important;">订单详情</h1>
		</header>
		<div class="mui-content">
		    <div class="order-filling-div1">
		    	<div style="background: #FFFFFF;padding: 10px 10px 5px 10px;border-radius:5px ;color: #333333;">
		    		<div>
		    			<span id="xianluname" style="font-size: 15px;display:block;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;"></span>
		    		</div>
			    	<div style="margin-top: 2px;">
			    		<span style="font-size: 14px;">开团日期：</span><span id="chufariqi" style="font-size: 12px;font: arial;"></span>
			    	</div>
			    	<div>
			    		<span style="font-size: 14px;" id="taocanming"></span>
			    	</div>
		    	</div>
		    	
		    </div>
		    <div class="order-filling-div2">
		    	<ul class="mui-table-view" style="margin-top: 5px;">
				    <li class="mui-table-view-cell" style="height: 40px;">
				        <span>添加出行人</span>
				        <input type="button" id="add" value="添加出行人" style="float: right;color: #FF8201;border: 1px solid #FF8201;margin-top: -5px;height: 30px;"/>
				    </li>
				    <li class="mui-table-view-cell " style="height: 40px;">
				        <span >人数</span>
				        <span style="width: 80%;float:right;height: 40px;margin-top: -6px;"><span>成人：</span><input type="text" onblur="jisuan1()" class="w25" value="0" style="width: 25%;height: 30px;border: 0px;border-bottom: 1px solid #EDEDED;" id="chenrenshu"/><span  style="margin-left: 10px;">小孩：</span><input type="text" onblur="jisuan1()" value="0" class="w25" style="width: 25%;height: 30px;border: 0px;border-bottom: 1px solid #EDEDED;" id="xiaohaishu"/></span>
				    </li>
				    
				</ul>
				<ul class="mui-table-view" style="margin-top: 5px;">
				    <li class="mui-table-view-cell">
				        <span >联系人</span>
				        <input type="text" style="width: 80%;float:right;height: 30px;margin-top: -5px;border: 0px;"placeholder="请输入姓名"/>
				    </li>
				    <li class="mui-table-view-cell">
				        <span >手 机</span>
				        <input type="number" style="width: 80%;float:right;height: 40px;margin-top: -10px;border: 0px;"placeholder="请输入手机号"/>
				    </li>
				    <li class="mui-table-view-cell danxuan">
				        <span >是否全陪</span>
				        <input type="radio"  name="quanpei" value="1" class="ml15"/><span class="ml5">是</span>
				        <input type="radio" checked  name="quanpei" value="0" class="ml10"/><span class="ml5">否</span>
				    </li>
				</ul>
				
				<ul class="mui-table-view disn" style="margin-top: 5px;">
				    <li class="mui-table-view-cell">
				        <span >全陪</span>
				        <input type="text" style="width: 80%;float:right;height: 30px;margin-top: -5px;border: 0px;"placeholder="请输入全陪姓名"/>
				    </li>
				    <li class="mui-table-view-cell">
				        <span >手 机</span>
				        <input type="number" style="width: 80%;float:right;height: 40px;margin-top: -10px;border: 0px;"placeholder="请输入手机号"/>
				    </li>
				</ul>
				<ul class="mui-table-view" style="margin-top: 5px;">
				    <li class="mui-table-view-cell">
				        <span >代收金额</span>
				        <input type="text" style="width: 80%;float:right;height: 30px;margin-top: -5px;border: 0px;"placeholder="0"/>
				    </li>
				    
				</ul>
				<ul class="mui-table-view disn" style="margin-top: 5px;">
				    <li class="mui-table-view-cell">
				        <span >附加费用</span>
				        <input type="text" onblur="jisuan()" style="width: 80%;float:right;height: 30px;margin-top: -5px;border: 0px;"placeholder="增加以‘＋’开头，减以‘－’开头， ‘+500’"/>
				    </li>
				    <li class="mui-table-view-cell" style="height: 100px;">
				        <span >附加费用说明</span>
				        <textarea id="textarea" placeholder="请填写附加费用说明" rows="3" style="width: 70%;float:right;height: 90px;margin-top: -5px;font-size: 14px;" ></textarea>
				    </li>
				    
				</ul>
				<ul class="mui-table-view" style="margin-top: 5px;">
				    <li class="mui-table-view-cell">
				        <span >总金额</span>
				        <input  type="text" readonly="readonly" style="width: 80%;float:right;height: 30px;margin-top: -5px;border: 0px;"placeholder="0"/>
				    </li>
				    <li class="mui-table-view-cell" style="height: 100px;">
				        <span >订单备注</span>
				        <textarea id="textarea1" placeholder="填写订单备注" rows="3" style="width: 75%;float:right;height: 90px;margin-top: -5px;font-size: 14px;" ></textarea>
				    </li>
				</ul>
		    </div>
		<div>
		    <input type="button" id="tijiaodindan" value="提交订单" style="color:#FFFFFF;font-size:17px;font-weight: bold;width: 96%;background:#FF8201 ; border: 0px;border-radius:5px ;height: 35px;margin-bottom: 5px;left: 2%;margin-top: 20px;"/>
		</div>
		   
		    
		</div>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/castapp.js" ></script>
		<script type="text/javascript">
			mui.init();
			ca.init();
			ca.whiteStatusBar();
			var zongqian=0;
			var youkexinxi;
			var checkedvalue=0;
			var xianluname=document.getElementById('xianluname');
			var chufariqi=document.getElementById('chufariqi');
			var taocanming=document.getElementById('taocanming');
			var chenrenshuinput=ca.id('chenrenshu');
			var xiaohaishuinput=ca.id('xiaohaishu');
			var childmoney='',chenrenshu='',xiaohaishu='',kaituanriqiid='',manmoney='',jiezhanriqi='',people='',
				jiezhanshijian='',jiezhanxinxi='',jiezhanzhusuyou='',jiezhanzhusuxingji='',jiezhanzhusuyongcan='',
				songzhanriqi='',songzhanshijian='',songzhanxinxi='',songzhanzhusuyou='',songzhanzhusuxingji='',songzhanzhusuyongcan='';
			var input=ca.tagName('input');
			var url=localStorage.getItem('url');
			
			ca.receiveNotice('update',function(){
				genxin();
			});
			
			function genxin(){
				chenrenshuinput.value=localStorage.getItem('darenshu');
				xiaohaishuinput.value=localStorage.getItem('childshu');
				zongqian=localStorage.getItem('renshumoney');
				youkexinxi=localStorage.getItem('youkexinxi');
				input[11].value=chenrenshuinput.value*manmoney+xiaohaishuinput.value*childmoney;;
			}
			function jisuan(){
				var va=input[10].value;
				var zifu=va.slice(0,1);
				if(zongqian==0){
					mui.toast('请添加出行人');
					return;
				}
				if(zifu=="+"){
					zongqian=localStorage.getItem('renshumoney');
					zongqian=parseInt(zongqian)+parseInt(va.slice(1));
					input[11].value=zongqian;
					return;
				}
				if(zifu=="-"){
					zongqian=localStorage.getItem('renshumoney');
					zongqian=parseInt(zongqian)-parseInt(va.slice(1));
					input[11].value=zongqian;
					return;
				}else{
					mui.toast('请输入正确的格式');
				}
			}
			function jisuan1(){
				var man=chenrenshuinput.value;
				var child=xiaohaishuinput.value;
				if(ca.emptyFun(man)){
					mui.toast('请输入成人数量！');
					input[1].focus();
					return;
				}
				if(ca.emptyFun(child)){
					mui.toast('请输入小孩数量！');
					input[2].focus();
					return;
				}
				if(!ca.isNumber(man)){
					mui.toast('请输入正确的成人数量！');
					input[1].focus();
					return;
				}
				if(!ca.isNumber(child)){
					mui.toast('请输入正确的小孩数量！');
					input[2].focus();
					return;
				}
				
				input[11].value=chenrenshuinput.value*manmoney+xiaohaishuinput.value*childmoney;
			}
			
			document.getElementById('add').addEventListener('tap',function(){
				localStorage.setItem('businesslist_or_order',1);
				ca.newInterface({
					url:'../add_pedestrian.html',
					id:'add_pedestrian'
				})
			})
			mui.plusReady(function(){
				var self = plus.webview.currentWebview();
				xianluname.innerHTML=self.xianluming;
				chufariqi.innerHTML=self.fabanriqi;
				taocanming.innerHTML=self.taocanmin;
				kaituanriqiid=self.fabanriqiid;
				manmoney=self.manmoney;
				childmoney=self.manmoney;
				
				ca.id('tijiaodindan').addEventListener('tap',function(){
				if(chenrenshuinput.value==0 && xiaohaishuinput.value==0){
					mui.toast('请添加出行人信息');
					return;
				}
				if(ca.emptyFun(youkexinxi)){
					mui.toast('请添加出行人信息');
					return;
				}
				if(ca.emptyFun(input[3].value) || ca.emptyFun(input[4].value)){
					mui.toast('请填写联系人信息');
					return;
				}
				if(input[4].value.length!=11){
					mui.toast('请填写正确的电话号码');
					return;
				}
				var zzong=parseInt(localStorage.getItem('darenshu'))+parseInt(localStorage.getItem('childshu'));
				var zong=parseInt(input[1].value)+parseInt(input[2].value);
				if(zzong!=zong){
					mui.toast('总人数不一致！');
					return;
				}
				
				ca.showWaiting();
				ca.checkTheNetwork();
				ca.ajaxs({url:'recordSheetLineOrder',data:{
						line_class_id:kaituanriqiid,
						user_id:localStorage.getItem('userid'),
						jidiaoid:self.jidiaoid,
						employee_id:self.yewuyuanid,
						tourist_info:JSON.parse(youkexinxi),
						line_standard:taocanming.innerHTML,
						man_num:chenrenshuinput.value,
						use_client_id:self.use_client_id,
						use_enterprise_id:self.kehuid,
						man_price:manmoney,
						child_price:childmoney,
						child_num:xiaohaishuinput.value,
						go_date:self.jiezhanriqi,
						go_time:self.jiezhanshijian,
						go_traffic:self.jiezhanxinxi,
						go_stay:self.jiezhanzhusuyou,
						go_stay_star:self.jiezhanzhusuxingji,
						go_food:self.jiezhanzhusuyongcan,
						back_date:self.songzhanriqi,
						back_time:self.songzhanshijian,
						back_traffic:self.songzhanxinxi,
						back_stay:self.songzhanzhusuyou,
						back_stay_star:self.songzhanzhusuxingji,
						back_food:self.songzhanzhusuyongcan,
						contact_name:input[3].value,
						contact_tel:input[4].value,
						collect_amount:input[9].value,
						is_guide:checkedvalue,
						order_mark:ca.id('textarea1').value,
						total_amount:input[11].value,
				},succFn:function(data){
						if(data.code>0){
								mui.toast(data.msg);
								var ws=plus.webview.getWebviewById('business_order_filling')
								plus.webview.close(ws);
								var ws1=plus.webview.getWebviewById('business_list_top')
								plus.webview.close(ws1);
								localStorage.removeItem('youkexinxi');
								localStorage.removeItem('renshumoney');
								localStorage.removeItem('darenshu');
								localStorage.removeItem('childshu');
						}else{
							mui.toast(data.msg);
						}
						ca.closeWaiting();
					},errFn:function(call){
						ca.closeWaiting();
						mui.toast(call);
					}
				})
				
				
				
				
//				mui.post(url+'addLineOrder',{
//						line_class_id:kaituanriqiid,
//						userid:localStorage.getItem('userid'),
//						user_id:localStorage.getItem('jidiaoid'),
//						tourist_info:JSON.parse(youkexinxi),
//						line_standard:taocanming.innerHTML,
//						man_num:chenrenshu.innerHTML,
//						use_client_id:localStorage.getItem('use_client_id'),
//						man_price:localStorage.getItem('manmoney'),
//						child_price:localStorage.getItem('childmoney'),
//						child_num:xiaohaishu.innerHTML,
//						go_date:localStorage.getItem('jiezhanriqi'),
//						go_time:localStorage.getItem('jiezhanshijian'),
//						go_traffic:localStorage.getItem('jiezhanxinxi'),
//						go_stay:localStorage.getItem('jiezhanzhusuyou'),
//						go_stay_star:localStorage.getItem('jiezhanzhusuxingji'),
//						go_food:localStorage.getItem('jiezhanzhusuyongcan'),
//						back_date:localStorage.getItem('songzhanriqi'),
//						back_time:localStorage.getItem('songzhanshijian'),
//						back_traffic:localStorage.getItem('songzhanxinxi'),
//						contact_name:input[1].value,
//						contact_tel:input[2].value,
//						collect_amount:input[7].value,
//						is_guide:checkedvalue,
//						other_cost:input[8].value.slice(1),
//						cost_mark:ca.id('textarea').value,
//						order_mark:ca.id('textarea1').value,
//						total_amount:input[9].value,
//				},function(data){
//					ca.closeWaiting();
//						//服务器返回响应，根据响应结果，分析是否登录成功；
//						if(data.msg=="ok"){
//							mui.toast('下单成功');
//							setTimeout(function(){
//								ca.newInterface({url:'order/business_order_top.html',id:'business_order_top'});
//								var ws=plus.webview.getWebviewById('order_filling')
//								plus.webview.close(ws);
//								var ws1=plus.webview.getWebviewById('business_order')
//								plus.webview.close(ws1);
//							},1000)
//						}
//						if(data.code==1){
//							mui.toast('下单成功,但消息可能未推送成功');
//							setTimeout(function(){
//								ca.newInterface({url:'order/business_order_top.html',id:'business_order_top'});
//								var ws=plus.webview.getWebviewById('order_filling')
//								plus.webview.close(ws);
//								var ws1=plus.webview.getWebviewById('business_order')
//								plus.webview.close(ws1);
//							},1000)
//							
//						}
//						if(data.msg=='fail'){
//							mui.toast('下单成功,但消息可能未推送成功');
//							setTimeout(function(){
//								ca.newInterface({url:'order/business_order_top.html',id:'business_order_top'});
//								var ws=plus.webview.getWebviewById('order_filling')
//								plus.webview.close(ws);
//								var ws1=plus.webview.getWebviewById('business_order')
//								plus.webview.close(ws1);
//							},1000)
//							
//						}
//						else{
//							mui.toast('下单失败，请重新下单');
//						}
//					});
			})
				mui('.danxuan').on('change', 'input', function() {
				    var value = this.checked?"true":"false";
				    checkedvalue=this.value;
				});
			})
			
		</script>
	</body>

</html>