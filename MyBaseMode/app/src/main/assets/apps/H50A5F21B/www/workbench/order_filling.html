<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/style.css" />
		<style>
			.mui-table-view-cell{
				height: 40px;
			}
			.mui-table-view-cell span{
				font-size: 15px;
				color: #333333;
				width: 30%;
			}
			.mui-table-view-cell input::-webkit-input-placeholder{
				
				font-size: 13px;
				color: #C3C3C3;
			}
			.mui-bar-nav{
				-webkit-box-shadow: 0 0px 0px #ccc;
    			box-shadow:0 0px 0px #ccc;
			}
			textarea{
				padding:4px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav user-index-top-bg mheader">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #FFFFFF !important;"></a>
		    <h1 class="mui-title" style="font-size: 18px !important;color: #FFFFFF !important;">订单详情</h1>
		</header>
		<div class="mui-content">
		    <div class="order-filling-div1">
		    	<div style="background: #FFFFFF;padding: 10px 10px 5px 10px;border-radius:5px ;color: #333333;">
		    		<div>
		    			<span id="xianluname" style="font-size: 15px;display:block;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;"></span>
		    		</div>
			    	<div style="margin-top: 2px;">
			    		<span style="font-size: 14px;">开团日期：</span><span id="chufariqi" style="font-size: 12px;font: arial;"></span>
			    	</div>
			    	<div>
			    		<span style="font-size: 14px;" id="taocanming"></span>
			    	</div>
		    	</div>
		    	
		    </div>
		    <div class="order-filling-div2">
		    	<ul class="mui-table-view" style="margin-top: 5px;">
				    <li class="mui-table-view-cell" style="height: 40px;">
				        <span>添加出行人</span>
				        <input type="button" id="add" value="添加出行人" style="float: right;color: #FF8201;border: 1px solid #FF8201;margin-top: -5px;height: 30px;"/>
				    </li>
				    <li class="mui-table-view-cell " style="height: 40px;">
				        <span >人数</span>
				        <span style="width: 80%;float:right;height: 40px;margin-top: -6px;"><span>成人：</span><input type="text" onblur="jisuan1()" class="w25" value="0" style="width: 25%;height: 30px;border: 0px;border-bottom: 1px solid #EDEDED;" id="chenrenshu"/><span  style="margin-left: 10px;">小孩：</span><input type="text" onblur="jisuan1()" value="0" class="w25" style="width: 25%;height: 30px;border: 0px;border-bottom: 1px solid #EDEDED;" id="xiaohaishu"/></span>
				    </li>
				    
				</ul>
				<ul class="mui-table-view" style="margin-top: 5px;">
				    <li class="mui-table-view-cell">
				        <span >联系人</span>
				        <input type="text" style="width: 80%;float:right;height: 30px;margin-top: -5px;border: 0px;"placeholder="请输入姓名"/>
				    </li>
				    <li class="mui-table-view-cell">
				        <span >手 机</span>
				        <input type="number" style="width: 80%;float:right;height: 40px;margin-top: -10px;border: 0px;"placeholder="请输入手机号"/>
				    </li>
				    <li class="mui-table-view-cell danxuan">
				        <span >是否全陪</span>
				        <input type="radio"  name="quanpei" value="1" class="ml15"/><span class="ml5">是</span>
				        <input type="radio" checked  name="quanpei" value="0" class="ml10"/><span class="ml5">否</span>
				    </li>
				</ul>
				
				<ul class="mui-table-view disn" style="margin-top: 5px;">
				    <li class="mui-table-view-cell">
				        <span >全陪</span>
				        <input type="text" style="width: 80%;float:right;height: 30px;margin-top: -5px;border: 0px;"placeholder="请输入全陪姓名"/>
				    </li>
				    <li class="mui-table-view-cell">
				        <span >手 机</span>
				        <input type="number" style="width: 80%;float:right;height: 40px;margin-top: -10px;border: 0px;"placeholder="请输入手机号"/>
				    </li>
				</ul>
				<ul class="mui-table-view" style="margin-top: 5px;">
				    <li class="mui-table-view-cell">
				        <span >代收金额</span>
				        <input type="text" style="width: 80%;float:right;height: 30px;margin-top: -5px;border: 0px;"placeholder="0"/>
				    </li>
				    
				</ul>
				<ul class="mui-table-view disn" style="margin-top: 5px;">
				    <li class="mui-table-view-cell">
				        <span >附加费用</span>
				        <input type="text" onblur="jisuan()" style="width: 80%;float:right;height: 30px;margin-top: -5px;border: 0px;"placeholder="增加以‘＋’开头，减以‘－’开头， ‘+500’"/>
				    </li>
				    <li class="mui-table-view-cell" style="height: 100px;">
				        <span >附加费用说明</span>
				        <textarea id="textarea" placeholder="请填写附加费用说明" rows="3" style="width: 70%;float:right;height: 90px;margin-top: -5px;font-size: 14px;" ></textarea>
				    </li>
				    
				</ul>
				<ul class="mui-table-view" style="margin-top: 5px;">
				    <li class="mui-table-view-cell">
				        <span >总金额</span>
				        <input  type="text" readonly="readonly" style="width: 80%;float:right;height: 30px;margin-top: -5px;border: 0px;"placeholder="0"/>
				    </li>
				    <li class="mui-table-view-cell" style="height: 100px;">
				        <span >订单备注</span>
				        <textarea id="textarea1" placeholder="填写订单备注" rows="3" style="width: 75%;float:right;height: 90px;margin-top: -5px;font-size: 14px;" ></textarea>
				    </li>
				</ul>
		    </div>
		<div class="mt10">
			<div class="fl w50">
					<input type="button" id="tijiaodindan1" value="保存为草稿单" style="color:#FFFFFF;font-size:17px;font-weight: bold;width: 96%;background:#999999 ; border: 0px;border-radius:5px ;height:40px;left: 2%;"/>
				</div>
			</div>
			<div class="fl w50">
						<input type="button" id="tijiaodindan2" value="提交订单" style="color:#FFFFFF;font-size:17px;font-weight: bold;width: 96%;background:#FF8201 ; border: 0px;border-radius:5px ;height:40px;left: 2%;"/>
				</div>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/castapp.js" ></script>
		<script type="text/javascript">
			mui.init();
			ca.init();
			ca.whiteStatusBar();
			var xianluname=document.getElementById('xianluname');
			var chufariqi=document.getElementById('chufariqi');
			var taocanming=document.getElementById('taocanming');
			var manmoney=localStorage.getItem('manmoney');
			var childmoney=localStorage.getItem('childmoney');
			var chenrenshu=ca.id('chenrenshu');
			var xiaohaishu=ca.id('xiaohaishu');
			var input=ca.tagName('input');
			var zongqian=0;
			var youkexinxi='';
			var checkedvalue=0;
			
			mui.plusReady(function(){
				var self=plus.webview.currentWebview();
				localStorage.setItem('renshu',self.zong_num);
				xianluname.innerHTML=self.xianlumingcheng;
				chufariqi.innerHTML=self.kaituanriqi;
				taocanming.innerHTML=self.taocanming;
				manmoney=self.manmoney;
				childmoney=self.manmoney;
				ca.receiveNotice('update',function(){
					genxin();
				});
				
				function genxin(){
					chenrenshu.value=localStorage.getItem('darenshu');
					xiaohaishu.value=localStorage.getItem('childshu');
					zongqian=localStorage.getItem('renshumoney');
					youkexinxi=localStorage.getItem('youkexinxi');
					input[11].value=chenrenshu.value*manmoney+xiaohaishu.value*childmoney;;
				}
				document.getElementById('add').addEventListener('tap',function(){
					localStorage.setItem('businesslist_or_order',0);
					ca.newInterface({
						url:'add_pedestrian.html',
						id:'add_pedestrian'
					})
				})
				ca.id('tijiaodindan2').addEventListener('tap',function(){
						tijiao(0);
				})
				
				ca.id('tijiaodindan1').addEventListener('tap',function(){
						tijiao(-1);
				})
				
				function tijiao(status){
					if(chenrenshu.value==0 && xiaohaishu.value==0){
						mui.toast('请添加出行人信息');
						return;
					}
					if(ca.emptyFun(input[3].value) || ca.emptyFun(input[4].value)){
						mui.toast('请填写联系人信息');
						return;
					}
					if(input[4].value.length!=11){
						mui.toast('请填写正确的电话号码');
						return;
					}
					var zzong=parseInt(localStorage.getItem('darenshu'))+parseInt(localStorage.getItem('childshu'));
					var zong=parseInt(input[1].value)+parseInt(input[2].value);
					if(zzong!=zong || self.zong_num!=zong){
						mui.toast('总人数不一致！');
						return;
					}
					ca.showWaiting();
					ca.ajaxs({url:'addLineOrder',data:{
							line_class_id:self.line_class_id,
							jidiaoid:self.jidiaoid,
							user_id:localStorage.getItem('userid'),
							tourist_info:JSON.parse(youkexinxi),
							line_standard:taocanming.innerHTML,
							man_num:chenrenshu.value,
							use_client_id:self.use_client_id,
							man_price:self.manmoney,
							child_price:self.childmoney,
							child_num:xiaohaishu.value,
							go_date:self.jiezhanriqi,
							go_time:self.jiezhanshijian,
							go_traffic:self.jiezhanxinxi,
							go_stay:self.jiezhanzhusuyou,
							go_stay_star:self.jiezhanzhusuxingji,
							go_food:self.jiezhanzhusuyongcan,
							back_date:self.songzhanriqi,
							back_time:self.songzhanshijian,
							back_traffic:self.songzhanxinxi,
							back_stay:self.songzhanzhusuyou,
							back_stay_star:self.songzhanzhusuxingji,
							back_food:self.songzhanzhusuyongcan,
							status:status,
							contact_name:input[3].value,
							contact_tel:input[4].value,
							collect_amount:input[9].value,
							is_guide:checkedvalue,
							order_mark:ca.id('textarea1').value,
							total_amount:input[11].value,
					},succFn:function(data){
								if(data.code>0){
										mui.toast('下单成功');
										var ws=plus.webview.getWebviewById('order_filling')
										plus.webview.close(ws);
										var ws1=plus.webview.getWebviewById('business_order')
										plus.webview.close(ws1);
										localStorage.removeItem('youkexinxi');
										localStorage.removeItem('renshumoney');
										localStorage.removeItem('darenshu');
										localStorage.removeItem('childshu');
								}else{
									mui.toast(data.msg);
								}
							ca.closeWaiting();
						},errFn:function(call){
							ca.closeWaiting();
							mui.toast(call);
						}
					})
				}
				mui('.danxuan').on('change', 'input', function() {
				    var value = this.checked?"true":"false";
				    checkedvalue=this.value;
				});
			})
			function jisuan(){
				var va=input[10].value;
				var zifu=va.slice(0,1);
				if(zongqian==0){
					mui.toast('请添加出行人');
					return;
				}
				if(zifu=="+"){
					zongqian=localStorage.getItem('renshumoney');
					zongqian=parseInt(zongqian)+parseInt(va.slice(1));
					input[11].value=zongqian;
					return;
				}
				if(zifu=="-"){
					zongqian=localStorage.getItem('renshumoney');
					zongqian=parseInt(zongqian)-parseInt(va.slice(1));
					input[11].value=zongqian;
					return;
				}else{
					mui.toast('请输入正确的格式');
				}
			}
			function jisuan1(){
				var man=chenrenshu.value;
				var child=xiaohaishu.value;
				if(ca.emptyFun(man)){
					mui.toast('请输入成人数量！');
					input[1].focus();
					return;
				}
				if(ca.emptyFun(child)){
					mui.toast('请输入小孩数量！');
					input[2].focus();
					return;
				}
				if(!ca.isNumber(man)){
					mui.toast('请输入正确的成人数量！');
					input[1].focus();
					return;
				}
				if(!ca.isNumber(child)){
					mui.toast('请输入正确的小孩数量！');
					input[2].focus();
					return;
				}
				
				input[11].value=chenrenshu.value*manmoney+xiaohaishu.value*childmoney;
			}
			
			
		</script>
	</body>

</html>